#!/bin/bash
set -e

echo "â° Iniciando Celery Beat..."
echo "ğŸ“Š DJANGO_ENV: ${DJANGO_ENV:-production}"

# Aguarda o Redis estar disponÃ­vel
echo "â³ Aguardando Redis..."
until (echo > /dev/tcp/redis/6379) >/dev/null 2>&1; do
    echo "Redis nÃ£o disponÃ­vel ainda - aguardando..."
    sleep 1
done
echo "âœ… Redis disponÃ­vel!"

# Aguarda o serviÃ§o web (pequeno atraso opcional)
echo "â³ Aguardando serviÃ§o web inicializar..."
sleep 5

# Inicia o Celery Beat
echo "ğŸš€ Iniciando Celery Beat com scheduler do Django..."
exec celery -A core beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
