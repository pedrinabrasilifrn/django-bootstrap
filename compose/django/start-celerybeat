#!/bin/bash
set -e

echo "‚è∞ Iniciando Celery Beat..."
echo "üìä DJANGO_ENV: ${DJANGO_ENV:-production}"

# Aguarda o Redis estar dispon√≠vel
echo "‚è≥ Aguardando Redis..."
until nc -z redis 6379; do
    echo "Redis n√£o dispon√≠vel ainda - aguardando..."
    sleep 1
done
echo "‚úÖ Redis dispon√≠vel!"

# Aguarda o servi√ßo web estar pronto (para garantir que as migra√ß√µes foram executadas)
echo "‚è≥ Aguardando servi√ßo web..."
sleep 5

exec celery -A core beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
